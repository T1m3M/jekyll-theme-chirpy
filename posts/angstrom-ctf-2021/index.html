<!DOCTYPE html><html lang="en" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="theme" content="Chirpy v2.5.1"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="Angstrom CTF 2021" /><meta name="author" content="Abdelrahman Nasr" /><meta property="og:locale" content="en_US" /><meta name="description" content="A place where you can find Reversing Engineering CTF challenges writeups, Malware Analysis reports and some low-level geeky stuff" /><meta property="og:description" content="A place where you can find Reversing Engineering CTF challenges writeups, Malware Analysis reports and some low-level geeky stuff" /><link rel="canonical" href="https://t1m3m.github.io/posts/angstrom-ctf-2021/" /><meta property="og:url" content="https://t1m3m.github.io/posts/angstrom-ctf-2021/" /><meta property="og:site_name" content="T1m3-m4ch1n3" /><meta property="og:image" content="https://t1m3m.github.io/assets/img/posts/2021-04-25-angstrom-ctf-2021/cover.jpg" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-04-25T00:57:00+02:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://t1m3m.github.io/assets/img/posts/2021-04-25-angstrom-ctf-2021/cover.jpg" /><meta property="twitter:title" content="Angstrom CTF 2021" /><meta name="twitter:site" content="@T1m3M" /><meta name="twitter:creator" content="@Abdelrahman Nasr" /><meta name="google-site-verification" content="wjab7JjezNdGg3dhJv8-6KbCIlqjjYnFBlntUWCuq3g" /> <script type="application/ld+json"> {"description":"A place where you can find Reversing Engineering CTF challenges writeups, Malware Analysis reports and some low-level geeky stuff","@type":"BlogPosting","headline":"Angstrom CTF 2021","dateModified":"2021-04-25T00:57:00+02:00","url":"https://t1m3m.github.io/posts/angstrom-ctf-2021/","datePublished":"2021-04-25T00:57:00+02:00","image":"https://t1m3m.github.io/assets/img/posts/2021-04-25-angstrom-ctf-2021/cover.jpg","mainEntityOfPage":{"@type":"WebPage","@id":"https://t1m3m.github.io/posts/angstrom-ctf-2021/"},"author":{"@type":"Person","name":"Abdelrahman Nasr"},"@context":"https://schema.org"}</script><title>Angstrom CTF 2021 | T1m3-m4ch1n3</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" as="style" href="/assets/css/post.css"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="/assets/js/post.min.js"></script> <script defer src="/app.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column"><div id="nav-wrapper"><div id="profile-wrapper" class="d-flex flex-column"><div id="avatar" class="d-flex justify-content-center"> <a href="/" alt="avatar"> <img src="/assets/img/sample/avatar.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="profile-text mt-3"><div class="site-title"> <a href="/">T1m3-m4ch1n3</a></div><div class="site-subtitle font-italic"></div></div></div><ul class="nav flex-column"><li class="nav-item d-flex justify-content-center "> <a href="/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/categories/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/tags/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/archives/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/about/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul></div><div class="sidebar-bottom d-flex flex-wrap justify-content-around mt-4"> <a href="https://github.com/T1m3M" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/T1m3M" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['1.h4ck.t1m3','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="https://linkedin.com/in/abdelrahman-nasr99/" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Angstrom CTF 2021</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Angstrom CTF 2021</h1><div class="post-meta text-muted d-flex flex-column"><div> Posted <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sun, Apr 25, 2021, 12:57 AM +0200" > Apr 25 <i class="unloaded">2021-04-25T00:57:00+02:00</i> </span> by <span class="author"> Abdelrahman Nasr </span></div></div><div class="post-content"> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/posts/2021-04-25-angstrom-ctf-2021/cover.jpg" class="post-preview-img"><p>Better late than never! This is my late writeup for some challenges of the great Angstrom CTF 2021. I hope you enjoy it (and the memes) and letâ€™s get started!!</p><hr /><h2 id="keysar-v2">Keysar v2</h2><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/posts/2021-04-25-angstrom-ctf-2021/info/keysar-v2.png" alt="Keysar v2" /></p><p>Given the source code of the encryption process:</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">string</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"key.txt"</span><span class="p">,</span> <span class="s">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">shift</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">readline</span><span class="p">())</span>
    <span class="n">key</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">readline</span><span class="p">()</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">"flag.txt"</span><span class="p">,</span> <span class="s">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">flag</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">read</span><span class="p">()</span>


<span class="n">stdalph</span> <span class="o">=</span> <span class="n">string</span><span class="p">.</span><span class="n">ascii_lowercase</span>
<span class="n">rkey</span> <span class="o">=</span> <span class="s">""</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">rkey</span><span class="p">:</span>
        <span class="n">rkey</span> <span class="o">+=</span> <span class="n">i</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">stdalph</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">rkey</span><span class="p">:</span>
        <span class="n">rkey</span> <span class="o">+=</span> <span class="n">i</span>
<span class="n">rkey</span> <span class="o">=</span> <span class="n">rkey</span><span class="p">[</span><span class="o">-</span><span class="n">shift</span><span class="p">:]</span> <span class="o">+</span> <span class="n">rkey</span><span class="p">[:</span><span class="o">-</span><span class="n">shift</span><span class="p">]</span>

<span class="n">enc</span> <span class="o">=</span> <span class="s">""</span>
<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">flag</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">stdalph</span><span class="p">:</span>
        <span class="n">enc</span> <span class="o">+=</span> <span class="n">rkey</span><span class="p">[</span><span class="n">stdalph</span><span class="p">.</span><span class="n">index</span><span class="p">(</span><span class="n">a</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">enc</span> <span class="o">+=</span> <span class="n">a</span>

<span class="k">print</span><span class="p">(</span><span class="n">enc</span><span class="p">)</span>
</pre></table></code></div></div><p>and the output of encrypting the flag:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>quutcvbmy ft qii amtkm iqkd tx qjbqfbtm, fzwcw bd mt kqo q sww dztgiv sw qsiw ft xio. bfd kbmyd qcw ftt drqii ft ywf bfd xqf ibffiw stvo txx fzw yctgmv. fzw sww, tx utgcdw, xibwd qmokqo swuqgdw swwd vtm'f uqcw kzqf zgrqmd fzbma bd brhtddbsiw. owiitk, siqua. owiitk, siqua. owiitk, siqua. owiitk, siqua. ttz, siqua qmv owiitk! iwf'd dzqaw bf gh q ibffiw. sqcco! scwqaxqdf bd cwqvo! utrbmy! zqmy tm q dwutmv. zwiit? sqcco? qvqr? uqm otg swibwjw fzbd bd zqhhwmbmy? b uqm'f. b'ii hbua otg gh. ittabmy dzqch. gdw fzw dfqbcd. otgc xqfzwc hqbv yttv rtmwo xtc fztdw. dtcco. b'r wnubfwv. zwcw'd fzw ycqvgqfw. kw'cw jwco hctgv tx otg, dtm. q hwcxwuf cwhtcf uqcv, qii s'd. jwco hctgv. rq! b ytf q fzbmy ytbmy zwcw. otg ytf ibmf tm otgc xgpp. tk! fzqf'd rw! kqjw ft gd! kw'ii sw bm ctk 118,000. sow! sqcco, b ftiv otg, dfth xiobmy bm fzw ztgdw! zwo, qvqr. zwo, sqcco. bd fzqf xgpp ywi? q ibffiw. dhwubqi vqo, ycqvgqfbtm. mwjwc fztgyzf b'v rqaw bf. fzcww vqod ycqvw duztti, fzcww vqod zbyz duztti. fztdw kwcw qkakqcv. fzcww vqod utiiwyw. b'r yiqv b ftta q vqo qmv zbfuzzbawv qctgmv fzw zbjw. otg vbv utrw squa vbxxwcwmf. zb, sqcco. qcfbw, yctkbmy q rgdfquzw? ittad yttv. zwqc qstgf xcqmabw? owqz. otg ytbmy ft fzw xgmwcqi? mt, b'r mtf ytbmy. wjwcostvo amtkd, dfbmy dtrwtmw, otg vbw. vtm'f kqdfw bf tm q degbccwi. dguz q ztfzwqv. b ygwdd zw utgiv zqjw lgdf ytffwm tgf tx fzw kqo. b itjw fzbd bmutchtcqfbmy qm qrgdwrwmf hqca bmft tgc vqo. fzqf'd kzo kw vtm'f mwwv jquqfbtmd. sto, egbfw q sbf tx htrh... gmvwc fzw ubcugrdfqmuwd. kwii, qvqr, ftvqo kw qcw rwm. kw qcw! sww-rwm. qrwm! zqiiwiglqz! dfgvwmfd, xqugifo, vbdfbmygbdzwv swwd, hiwqdw kwiutrw vwqm sgppkwii. kwiutrw, mwk zbjw ubfo ycqvgqfbmy uiqdd tx... ...9:15. fzqf utmuigvwd tgc uwcwrtmbwd. qmv swybmd otgc uqcwwc qf ztmwn bmvgdfcbwd! kbii kw hbua tgclts ftvqo? b zwqcv bf'd lgdf tcbwmfqfbtm. zwqvd gh! zwcw kw yt. awwh otgc zqmvd qmv qmfwmmqd bmdbvw fzw fcqr qf qii fbrwd. ktmvwc kzqf bf'ii sw ibaw? q ibffiw duqco. kwiutrw ft ztmwn, q vbjbdbtm tx ztmwdut qmv q hqcf tx fzw zwnqytm yctgh. fzbd bd bf! ktk. ktk. kw amtk fzqf otg, qd q sww, zqjw ktcawv otgc kztiw ibxw ft ywf ft fzw htbmf kzwcw otg uqm ktca xtc otgc kztiw ibxw. ztmwo swybmd kzwm tgc jqibqmf htiiwm ltuad scbmy fzw mwufqc ft fzw zbjw. tgc fth-dwucwf xtcrgiq bd qgftrqfbuqiio utitc-utccwufwv, duwmf-qvlgdfwv qmv sgssiw-utmftgcwv bmft fzbd dttfzbmy dkwwf docgh kbfz bfd vbdfbmufbjw ytivwm yitk otg amtk qd... ztmwo! fzqf ybci kqd ztf. dzw'd ro utgdbm! dzw bd? owd, kw'cw qii utgdbmd. cbyzf. otg'cw cbyzf. qf ztmwn, kw utmdfqmfio dfcbjw ft brhctjw wjwco qdhwuf tx sww wnbdfwmuw. fzwdw swwd qcw dfcwdd-fwdfbmy q mwk zwirwf fwuzmtityo. kzqf vt otg fzbma zw rqawd? mtf wmtgyz. zwcw kw zqjw tgc iqfwdf qvjqmuwrwmf, fzw acwirqm. qufx{awowvuqwdqcrtcwibawdgsdfbfgfbtm}
</pre></table></code></div></div><p>I took a look at the source code this line caught my attention <code class="language-plaintext highlighter-rouge">rkey = rkey[-shift:] + rkey[:-shift]</code> and the couple lines before .. because these lines basically put the key first and then fill the string with the alphabet <em>without repeating</em> and then shifts the string .. Huh, sounds like a keyed Caesar cipher to me .. Yeah, because itâ€™s!</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/posts/2021-04-25-angstrom-ctf-2021/memes/meme_0.gif" alt="just a meme" /></p><p>Another quick note is the output is long so you can apply a frequency analysis! and using this <a href="https://www.boxentriq.com/code-breaking/keyed-caesar-cipher">online tool site</a> with auto solve I was able to retrieve the key <code class="language-plaintext highlighter-rouge">qsuvwxyzbeairmthlcdfgjkpon</code> and hence the flag: <code class="language-plaintext highlighter-rouge">actf{keyedcaesarmorelikesubstitution}</code></p><hr /><h2 id="exclusive-cipher">Exclusive cipher</h2><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/posts/2021-04-25-angstrom-ctf-2021/info/ex-cipher.png" alt="Exclusive cipher" /></p><p>The encoded cipher text:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>ae27eb3a148c3cf031079921ea3315cd27eb7d02882bf724169921eb3a469920e07d0b883bf63c018869a5090e8868e331078a68ec2e468c2bf13b1d9a20ea0208882de12e398c2df60211852deb021f823dda35079b2dda25099f35ab7d218227e17d0a982bee7d098368f13503cd27f135039f68e62f1f9d3cea7c
</pre></table></code></div></div><p>Okay given XOR key is 5 bytes long (5 characters), the flag is somewhere in the message, fortunately we know also 5 characters of the flag <code class="language-plaintext highlighter-rouge">actf{</code> and that XOR is bidirectional. So when I XOR the whole cipher text with <code class="language-plaintext highlighter-rouge">actf{</code> 5 bytes, somewhere in the result lies the 5 bytes key!</p><p>Since I donâ€™t know where exactly is the key I made this simple script to take 5 bytes chunks from start of the result at a time and try to decode the cipher text with it:</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre><td class="rouge-code"><pre><span class="c1">#!/bin/env python3
</span>
<span class="kn">from</span> <span class="nn">Crypto.Util.number</span> <span class="kn">import</span> <span class="n">long_to_bytes</span>
<span class="kn">from</span> <span class="nn">Crypto.Util.number</span> <span class="kn">import</span> <span class="n">bytes_to_long</span>
<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="n">xor</span>

<span class="n">c</span> <span class="o">=</span> <span class="s">"ae27eb3a148c3cf031079921ea3315cd27eb7d02882bf724169921eb3a469920e07d0b883bf63c018869a5090e8868e331078a68ec2e468c2bf13b1d9a20ea0208882de12e398c2df60211852deb021f823dda35079b2dda25099f35ab7d218227e17d0a982bee7d098368f13503cd27f135039f68e62f1f9d3cea7c"</span>

<span class="n">data_bytes</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

<span class="n">key</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">after_xor</span> <span class="o">=</span> <span class="n">xor</span><span class="p">(</span><span class="n">data_bytes</span><span class="p">,</span> <span class="sa">b</span><span class="s">'actf{'</span><span class="p">).</span><span class="nb">hex</span><span class="p">()</span>

<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">print</span><span class="p">(</span><span class="n">after_xor</span><span class="p">)</span>

<span class="n">pos_keys</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">after_xor</span><span class="p">):</span>
    <span class="n">pos_keys</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">after_xor</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">10</span><span class="p">])</span>

    <span class="n">i</span> <span class="o">+=</span> <span class="mi">10</span>

<span class="k">for</span> <span class="n">pos_key</span> <span class="ow">in</span> <span class="n">pos_keys</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">xor</span><span class="p">(</span><span class="n">data_bytes</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">pos_key</span><span class="p">)).</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">))</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">continue</span>
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/posts/2021-04-25-angstrom-ctf-2021/challenges/ex-cipher/ex-cipher-flag.png" alt="Exclusive cipher's script" /></p><p>Pretty straightforward! the flag: <code class="language-plaintext highlighter-rouge">actf{who_needs_aes_when_you_have_xor}</code></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/posts/2021-04-25-angstrom-ctf-2021/memes/meme_1.gif" alt="just a meme" /></p><hr /><h2 id="jailbreak">Jailbreak</h2><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/posts/2021-04-25-angstrom-ctf-2021/info/jailbreak.png" alt="Jailbreak" /></p><p>Jail? break? We need sherlock to solve this one!</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/posts/2021-04-25-angstrom-ctf-2021/memes/meme_2.gif" alt="just a meme" /></p><p>I found assembly is more comfortable to me than the pseudo code, so in the following picture we can see the main function which starts by allocating registers which will be used in deciding the flow of the program and comparisons:</p><ul><li><code class="language-plaintext highlighter-rouge">r12d = 0</code><li><code class="language-plaintext highlighter-rouge">r13d = 1</code><li><code class="language-plaintext highlighter-rouge">r14d = 0</code><li><code class="language-plaintext highlighter-rouge">r15d = 0</code> <em>which I knew by debugging</em></ul><p>Then I faced a string obfuscation technique which is deobfuscated by a function I called later <code class="language-plaintext highlighter-rouge">stringy</code> which can be called indirectly using <code class="language-plaintext highlighter-rouge">call_stringy</code> (I named that too)</p><p>I got the strings using dynamic analysis by setting breakpoints before puts to read <code class="language-plaintext highlighter-rouge">rdi</code> register which holds the value that will be printed on the terminal, another nice solution I knew later is to reverse the <code class="language-plaintext highlighter-rouge">stringy</code> function and get the strings!</p><p>I made comments in the disassembly with those strings to make the reversing easier</p><p>Another note is these blue arrows coming back to this second block means that after each choice the flow goes back and starts from here so this is obviously a loop</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/posts/2021-04-25-angstrom-ctf-2021/challenges/jailbreak/first_blocks.png" alt="first blocks" /></p><p>Next is a crossroad which checks if the input is <code class="language-plaintext highlighter-rouge">look around</code> if so it prints the scene information otherwise it continues to a second check, but before diving in I followed the right branch which happens if <code class="language-plaintext highlighter-rouge">r12d != 0</code></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/posts/2021-04-25-angstrom-ctf-2021/challenges/jailbreak/two-ways.png" alt="two ways" /></p><p>Here it starts with a check if <code class="language-plaintext highlighter-rouge">r12d == 1337</code> and the input is <code class="language-plaintext highlighter-rouge">bananarama</code> I get the flag otherwise if r12d is not 1337 I have two choices:</p><ul><li>if input is <code class="language-plaintext highlighter-rouge">press the red button</code> then <code class="language-plaintext highlighter-rouge">r12d += r12d</code><li>if input is <code class="language-plaintext highlighter-rouge">press the green button</code> then <code class="language-plaintext highlighter-rouge">r12d += r12d + 1</code></ul><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/posts/2021-04-25-angstrom-ctf-2021/challenges/jailbreak/buttons.jpg" alt="buttons of right" /></p><p>So to sum up to get the flag <code class="language-plaintext highlighter-rouge">r12d</code> should equal <code class="language-plaintext highlighter-rouge">1337</code> <em>which happens through pressing the buttons in the right order</em> and the input should be <code class="language-plaintext highlighter-rouge">bananarama</code></p><p>but first to make <code class="language-plaintext highlighter-rouge">r12d != 0</code> I needed to dive in the left side of branches</p><p>After analyzing the left side I found that r12d can be equal to 1 if and only if the input is <code class="language-plaintext highlighter-rouge">pry the bars open</code> I commented that like as <code class="language-plaintext highlighter-rouge">(((the destination)))</code></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/posts/2021-04-25-angstrom-ctf-2021/challenges/jailbreak/bars.png" alt="pry the bars open" /></p><p>But this happens only if <code class="language-plaintext highlighter-rouge">r13b == 0</code> which is initialized to 1 in main if you remember! and to make that case the input should be <code class="language-plaintext highlighter-rouge">throw the snake at at kmh</code> and that like is commented as <code class="language-plaintext highlighter-rouge">((( the destination 2 )))</code> in the following image:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/posts/2021-04-25-angstrom-ctf-2021/challenges/jailbreak/throw.png" alt="throw the snake at kmh" /></p><p>But also for this to happen there is a condition above <code class="language-plaintext highlighter-rouge">r14b != 0</code> and to fulfill this the input should be <code class="language-plaintext highlighter-rouge">pick the snake up</code> which sets <code class="language-plaintext highlighter-rouge">r14d = ebp</code> that is non-zero value</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/posts/2021-04-25-angstrom-ctf-2021/challenges/jailbreak/pick.png" alt="pick the snake up" /></p><p>so going backwards is the correct steps to move to the right branch:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>pick the snake up
throw the snake at kmh
pry the bars open
</pre></table></code></div></div><p>Now since I moved to the right branch to make <code class="language-plaintext highlighter-rouge">r12d == 1337</code> through the increments in the green and red buttons I made a python script to figure that sequence out instead of factoring by hand to save time:</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre><td class="rouge-code"><pre><span class="c1">#!/bin/env python3
</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>

<span class="n">key</span> <span class="o">=</span> <span class="mi">1337</span>
<span class="n">sum_all</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">ops</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">sums</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">select</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">ops</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">select</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">select</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">sum_all</span> <span class="o">+=</span> <span class="n">sum_all</span> <span class="o">+</span><span class="mi">1</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">sum_all</span> <span class="o">+=</span> <span class="n">sum_all</span>


    <span class="n">sums</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">sum_all</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">sum_all</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
        <span class="k">break</span>

    <span class="k">if</span> <span class="n">sum_all</span> <span class="o">&gt;</span> <span class="n">key</span><span class="p">:</span>
        <span class="n">sum_all</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">ops</span><span class="p">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">sums</span><span class="p">.</span><span class="n">clear</span><span class="p">()</span>

<span class="c1"># output of possible permutations
# [1, 0, 1, 1, 0, 0, 0, 1, 1, 0]
</span>
<span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">ops</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">op</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"press the green button"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"press the red button"</span><span class="p">)</span>
</pre></table></code></div></div><p>And the result was:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/posts/2021-04-25-angstrom-ctf-2021/challenges/jailbreak/factor.png" alt="factor script" /></p><p>And following that by <code class="language-plaintext highlighter-rouge">bananarama</code> to get the flag the full steps should be:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>pick the snake up
throw the snake at kmh
pry the bars open
press the red button
press the green button
press the red button
press the red button
press the green button
press the green button
press the green button
press the red button
press the red button
press the green button
bananarama
</pre></table></code></div></div><p>Piping the payload to the shell server should give us the flag: <code class="language-plaintext highlighter-rouge">actf{guess_kmh_still_has_unintended_solutions}</code></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/posts/2021-04-25-angstrom-ctf-2021/challenges/jailbreak/response.png" alt="shell response" /></p><p>That was a nice challenge, Watson!</p><hr /><h2 id="infinity-gauntlet">Infinity gauntlet</h2><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/posts/2021-04-25-angstrom-ctf-2021/info/infinity-gauntlet.png" alt="Infinity gauntlet" /></p><p>As a Marvelâ€™s fan I wanted to solve this challenge so I can be an Avenger too! :D .. Itâ€™s more of a coding challenge like 20% is reversing and 80% of the problem is pure coding .. Iâ€™m talking about +100 lines of python code here!</p><p>At first glance I saw this simple encryption by reading the flag to variable <code class="language-plaintext highlighter-rouge">s</code> then XORing the i-th letter in the flag with <code class="language-plaintext highlighter-rouge">i * 0x11 % 256</code> so donâ€™t forget after getting the letters to XOR back with the corresponding value to get the original letter back!</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/posts/2021-04-25-angstrom-ctf-2021/challenges/infinity-gauntlet/start.png" alt="start of code" /></p><p>Then there is an infinite loop (sounds like infinity war to me) that contains 2 types of equations <code class="language-plaintext highlighter-rouge">foo</code> and <code class="language-plaintext highlighter-rouge">bar</code> equations, <code class="language-plaintext highlighter-rouge">foo</code> with 2 known variables and one unknown (3 possible permutations) and <code class="language-plaintext highlighter-rouge">bar</code> with 3 known variables and one unknown (4 possible permutations)</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/posts/2021-04-25-angstrom-ctf-2021/challenges/infinity-gauntlet/foo.png" alt="foo code" /></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/posts/2021-04-25-angstrom-ctf-2021/challenges/infinity-gauntlet/bar.png" alt="bar code" /></p><p>The input is the unknown variable so I needed to solve the equation for each question and it should be correct to go to the next round otherwise it puts <code class="language-plaintext highlighter-rouge">wrong</code> and exits, but whatâ€™s the point of solving the functions?</p><p>The answer to the previous question is <code class="language-plaintext highlighter-rouge">r</code> variable thatâ€™s the unknown in these equations and this variable is <em>as you can see in line 67</em> (if round number &gt; 49) a random letter <strong>in the flag</strong> as the LSB and the MSB is <code class="language-plaintext highlighter-rouge">random % len_flag + round_num</code> and since we can have all but the random value (which can act as the index of the random letter in the flag) then reversing this we can have the letter and its position in the flag string!</p><p>Putting all pieces together, we need to:</p><ul><li>identify the function type and which variable is the unknown<li>reversing the 7 equations to get the unknown (the <code class="language-plaintext highlighter-rouge">r</code> variable)<li>extracting MSB and LSB from <code class="language-plaintext highlighter-rouge">r</code> to get the letter and index<li>decrypting the letter with the XOR <code class="language-plaintext highlighter-rouge">0x11 * index</code></ul><p>Note that I used static analysis to reverse the 7 equations + dynamic analysis to prove my reversing with numbers just to make sure</p><p>This is a python script I wrote to do all of that:</p><div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
</pre><td class="rouge-code"><pre><span class="c1">#!/bin/env python3
</span>
<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="n">len_flag</span> <span class="o">=</span> <span class="mi">49</span>

<span class="n">flag</span> <span class="o">=</span> <span class="p">[</span><span class="s">"-"</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">len_flag</span><span class="p">)]</span>

<span class="k">def</span> <span class="nf">decrypt_xor</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>

    <span class="n">xor_value</span> <span class="o">=</span> <span class="mh">0x11</span> <span class="o">*</span> <span class="n">pos</span> <span class="o">%</span> <span class="mi">256</span>
    <span class="k">return</span> <span class="nb">chr</span><span class="p">(</span><span class="n">xor_value</span> <span class="o">^</span> <span class="nb">ord</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">get_index</span><span class="p">(</span><span class="n">msb</span><span class="p">,</span> <span class="n">round_</span><span class="p">):</span>

    <span class="n">msb_hex</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="n">msb</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">len_flag</span><span class="p">):</span>

        <span class="n">index_plus_r</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="n">len_flag</span> <span class="o">+</span> <span class="n">round_</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">msb_hex</span><span class="p">):]</span>

        <span class="k">if</span> <span class="n">index_plus_r</span> <span class="o">==</span> <span class="n">msb_hex</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">i</span>


<span class="k">def</span> <span class="nf">func_identify</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">round_num</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">q</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">"foo"</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">q_type</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># foo
</span>
    <span class="k">elif</span> <span class="n">q</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">"bar"</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">q_type</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># bar
</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s">'^(foo|bar)\(|\) =|,|\n'</span><span class="p">,</span> <span class="s">""</span><span class="p">,</span> <span class="n">q</span><span class="p">).</span><span class="n">split</span><span class="p">(</span><span class="s">' '</span><span class="p">)</span>

    <span class="n">q_mark_pos</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">index</span><span class="p">(</span><span class="s">'?'</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">q_type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">q_mark_pos</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">foo_1</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>

        <span class="k">elif</span> <span class="n">q_mark_pos</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">foo_2</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>

        <span class="k">elif</span> <span class="n">q_mark_pos</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">foo_3</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">q_mark_pos</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">bar_1</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>

        <span class="k">elif</span> <span class="n">q_mark_pos</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">bar_2</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>

        <span class="k">elif</span> <span class="n">q_mark_pos</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">bar_3</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>

        <span class="k">elif</span> <span class="n">q_mark_pos</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">bar_4</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>


    <span class="k">if</span> <span class="n">round_num</span> <span class="o">&gt;</span> <span class="mi">49</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">result</span><span class="p">)[</span><span class="mi">2</span><span class="p">:])</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>

        <span class="c1"># restoring the most significant byte
</span>        <span class="n">msb</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">result</span><span class="p">)[</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="mi">16</span><span class="p">)</span> <span class="c1"># 0xXX--
</span>        <span class="n">index</span> <span class="o">=</span> <span class="n">get_index</span><span class="p">(</span><span class="n">msb</span><span class="p">,</span> <span class="n">round_num</span><span class="p">)</span>


        <span class="c1"># restoring the least significant byte
</span>        <span class="n">val</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">result</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">:],</span> <span class="mi">16</span><span class="p">))</span> <span class="c1"># 0x--XX
</span>        <span class="n">letter</span> <span class="o">=</span> <span class="n">decrypt_xor</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

        <span class="c1"># getting the letter if it's printable
</span>        <span class="k">if</span> <span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">letter</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mh">0x20</span> <span class="ow">and</span> <span class="nb">ord</span><span class="p">(</span><span class="n">letter</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mh">0x39</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">letter</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mh">0x40</span> <span class="ow">and</span> <span class="nb">ord</span><span class="p">(</span><span class="n">letter</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mh">0x7d</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"@ %i -&gt; letter = %s"</span> <span class="o">%</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">letter</span><span class="p">))</span>

            <span class="n">flag</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">letter</span>
            <span class="k">print</span><span class="p">(</span><span class="s">''</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">flag</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">result</span>

<span class="k">def</span> <span class="nf">foo_1</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>

    <span class="n">r</span> <span class="o">=</span> <span class="n">b</span> <span class="o">^</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">^</span> <span class="mi">1337</span>
    <span class="k">return</span> <span class="n">r</span>


<span class="k">def</span> <span class="nf">foo_2</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>

    <span class="n">r</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">^</span> <span class="n">a</span> <span class="o">^</span> <span class="mi">1337</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">r</span>

<span class="k">def</span> <span class="nf">foo_3</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>

    <span class="n">r</span> <span class="o">=</span> <span class="n">a</span> <span class="o">^</span> <span class="p">(</span><span class="n">b</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">^</span> <span class="mi">1337</span>
    <span class="k">return</span> <span class="n">r</span>


<span class="k">def</span> <span class="nf">bar_1</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>

    <span class="n">r</span> <span class="o">=</span> <span class="n">c</span> <span class="o">-</span> <span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="n">b</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">r</span>


<span class="k">def</span> <span class="nf">bar_2</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>

    <span class="n">r</span> <span class="o">=</span> <span class="p">(</span><span class="n">c</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">//</span> <span class="p">(</span><span class="n">b</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">r</span>


<span class="k">def</span> <span class="nf">bar_3</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>

    <span class="n">r</span> <span class="o">=</span> <span class="p">((</span><span class="n">c</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">//</span> <span class="n">b</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">r</span>


<span class="k">def</span> <span class="nf">bar_4</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>

    <span class="n">r</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="p">(</span><span class="n">c</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">r</span>


<span class="c1"># main
</span><span class="n">s</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="s">'./infinity_gauntlet'</span><span class="p">)</span>

<span class="n">s</span><span class="p">.</span><span class="n">recvline</span><span class="p">()</span>
<span class="n">s</span><span class="p">.</span><span class="n">recvline</span><span class="p">()</span>

<span class="n">round_num</span> <span class="o">=</span> <span class="mi">1</span>

<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>

    <span class="n">res</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">recvline</span><span class="p">().</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)</span> <span class="c1"># round number line
</span>
    <span class="k">if</span> <span class="n">res</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">"ROUND"</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">round_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="p">.</span><span class="n">sub</span><span class="p">(</span><span class="s">"[^\d]"</span><span class="p">,</span> <span class="s">""</span><span class="p">,</span> <span class="n">res</span><span class="p">))</span>

    <span class="k">elif</span> <span class="n">res</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">"foo"</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">res</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">"bar"</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">func_identify</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">round_num</span><span class="p">)</span>
        <span class="n">s</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>


<span class="n">s</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</pre></table></code></div></div><p>By running this on the shell server I watched as the flag was being formed</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/posts/2021-04-25-angstrom-ctf-2021/challenges/infinity-gauntlet/flag.png" alt="Infinity gauntlet flag" /></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/posts/2021-04-25-angstrom-ctf-2021/memes/meme_3.gif" alt="just a meme" /></p><p>The flag is: <code class="language-plaintext highlighter-rouge">actf{snapped_away_the_end}</code> I shouldâ€™ve gone for the head tho!</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/ctf/'>CTF</a>, <a href='/categories/writeups/'>Writeups</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/ctf/" class="post-tag no-text-decoration" >ctf</a> <a href="/tags/writeups/" class="post-tag no-text-decoration" >writeups</a> <a href="/tags/reverse/" class="post-tag no-text-decoration" >reverse</a> <a href="/tags/reverse-engineering/" class="post-tag no-text-decoration" >reverse-engineering</a> <a href="/tags/assembly/" class="post-tag no-text-decoration" >assembly</a> <a href="/tags/idapro/" class="post-tag no-text-decoration" >idapro</a> <a href="/tags/python/" class="post-tag no-text-decoration" >python</a> <a href="/tags/crypto/" class="post-tag no-text-decoration" >crypto</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Angstrom CTF 2021 - T1m3-m4ch1n3&url=https://T1m3M.github.io/posts/angstrom-ctf-2021/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Angstrom CTF 2021 - T1m3-m4ch1n3&u=https://T1m3M.github.io/posts/angstrom-ctf-2021/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Angstrom CTF 2021 - T1m3-m4ch1n3&url=https://T1m3M.github.io/posts/angstrom-ctf-2021/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://T1m3M.github.io/posts/angstrom-ctf-2021/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Marathon-CTF/">Marathon CTF</a><li><a href="/posts/MIPS-cheatsheet/">MIPS cheatsheet</a><li><a href="/posts/RE/">What is Reverse Engineering? | Ù…Ø§ Ù‡Ù‰ Ø§Ù„Ù‡Ù†Ø¯Ø³Ø© Ø§Ù„Ø¹ÙƒØ³ÙŠØ©ØŸ</a><li><a href="/posts/cybertalents-cairo-university-2019-ctf/">CyberTalents Cairo University CTF 2019</a><li><a href="/posts/auctf-2020/">AUCTF 2020</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/reverse-engineering/">reverse engineering</a> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/writeups/">writeups</a> <a class="post-tag" href="/tags/assembly/">assembly</a> <a class="post-tag" href="/tags/crypto/">crypto</a> <a class="post-tag" href="/tags/idapro/">idapro</a> <a class="post-tag" href="/tags/reverse/">reverse</a> <a class="post-tag" href="/tags/anti-debugging/">anti debugging</a> <a class="post-tag" href="/tags/binary-exploitation/">binary exploitation</a> <a class="post-tag" href="/tags/cheatsheet/">cheatsheet</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Marathon-CTF/"><div class="card-body"> <span class="timeago small" > Apr 2 <i class="unloaded">2021-04-02T10:30:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Marathon CTF</h3><div class="text-muted small"><p> Marathon CTF was a great CTF organized by CyberTalents during the whole month (1 Mar. - 31 Mar. 2021) but I participated during only the last 4 days and I got the 28th place (same points ad 25th) ...</p></div></div></a></div><div class="card"> <a href="/posts/angstrom-ctf-2020/"><div class="card-body"> <span class="timeago small" > Dec 1, 2020 <i class="unloaded">2020-12-01T03:20:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Angstrom CTF 2020</h3><div class="text-muted small"><p> Ã¥ngstromCTF 2020 was really a great competition and we as P1rates team enjoyed it and learned a lot, Hereâ€™s my writeup about what i solved. Challenges Title Category S...</p></div></div></a></div><div class="card"> <a href="/posts/cybertalents-cairo-university-2019-ctf/"><div class="card-body"> <span class="timeago small" > Nov 30, 2020 <i class="unloaded">2020-11-30T21:40:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>CyberTalents Cairo University CTF 2019</h3><div class="text-muted small"><p> It was the first year for CyberTalentsâ€™s Cybersecurity CTF Competition at Cairo University and was also my first time to participate in a real-life CTF! NOTE: the descriptions of the challenges a...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Marathon-CTF/" class="btn btn-outline-primary"><p>Marathon CTF</p></a> <span class="btn btn-outline-primary disabled"><p>-</p></span></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> Â© 2021 <a href="https://twitter.com/T1m3M">Abdelrahman Nasr</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy/" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/reverse-engineering/">reverse engineering</a> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/writeups/">writeups</a> <a class="post-tag" href="/tags/assembly/">assembly</a> <a class="post-tag" href="/tags/crypto/">crypto</a> <a class="post-tag" href="/tags/idapro/">idapro</a> <a class="post-tag" href="/tags/reverse/">reverse</a> <a class="post-tag" href="/tags/anti-debugging/">anti debugging</a> <a class="post-tag" href="/tags/binary-exploitation/">binary exploitation</a> <a class="post-tag" href="/tags/cheatsheet/">cheatsheet</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://T1m3M.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-1WZELSLYX1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-1WZELSLYX1'); </script>
